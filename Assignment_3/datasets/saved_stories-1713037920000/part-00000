{"aid": "40023128", "title": "Troubleshoot", "url": "https://blog.cloudflare.com/a-question-of-timing", "domain": "cloudflare.com", "votes": 1, "user": "akisuzuki", "posted_at": "2024-04-13 13:49:30", "comments": 0, "source_title": "A Question of Timing", "source_text": "A Question of Timing\n\nGet Started Free|Contact Sales\n\n## The Cloudflare Blog\n\nSubscribe to receive notifications of new posts:\n\n# A Question of Timing\n\n10/17/2018\n\n  * Piers Cornwell\n\n4 min read\n\nPhoto by Aron / Unsplash\n\nWhen considering website performance, the term TTFB - time to first byte -\ncrops up regularly. Often we see measurements from cURL and Chrome, and this\narticle will show what timings those tools can produce, including time to\nfirst byte, and discuss whether this is the measurement you are really looking\nfor.\n\n### Timing with cURL\n\ncURL is an excellent tool for debugging web requests, and it includes the\nability to take timing measurements. Let\u2019s take an example website\nwww.zasag.mn (the Mongolian government), and measure how long a request to its\nhome page takes:\n\nFirst configure the output format for cURL in ~/.curlrc:\n\n    \n    \n    $ cat .curlrc -w \"dnslookup: %{time_namelookup} | connect: %{time_connect} | appconnect: %{time_appconnect} | pretransfer: %{time_pretransfer} | starttransfer: %{time_starttransfer} | total: %{time_total} | size: %{size_download}\\n\"\n\nNow connect to the site dropping the output (-o /dev/null) since we\u2019re only\ninterested in the timing:\n\n    \n    \n    $ curl -so /dev/null https://www.zasag.mn dnslookup: 1.510 | connect: 1.757 | appconnect: 2.256 | pretransfer: 2.259 | starttransfer: 2.506 | total: 3.001 | size: 53107\n\nThese timings are in seconds. Depending on your version of cURL, you may get\nmore decimal places than this example. 3 seconds is a long time, and remember\nthis is only for the HTML from the home page - it doesn\u2019t include any\nJavaScript, images, etc.\n\nThe diagram below shows what each of those timings refer to against a typical\nHTTP over TLS 1.2 connection (TLS 1.3 setup needs one less round trip):\n\n  * time_namelookup in this example takes a long time. To exclude DNS resolver performance from the figures, you can resolve the IP for cURL: --resolve www.zasag.mn:443:218.100.84.167. It may also be worth looking for a faster resolver :).\n  * time_connect is the TCP three-way handshake from the client\u2019s perspective. It ends just after the client sends the ACK - it doesn't include the time taken for that ACK to reach the server. It should be close to the round-trip time (RTT) to the server. In this example, RTT looks to be about 200 ms.\n  * time_appconnect here is TLS setup. The client is then ready to send it\u2019s HTTP GET request.\n  * time_starttransfer is just before cURL reads the first byte from the network (it hasn't actually read it yet). time_starttransfer - time_appconnect is practically the same as Time To First Byte (TTFB) from this client - 250 ms in this example case. This includes the round trip over the network, so you might get a better guess of how long the server spent on the request by calculating TTFB - (time_connect - time_namelookup), so in this case, the server spent only a few milliseconds responding, the rest of the time was the network.\n  * time_total is just after the client has sent the FIN connection tear down.\n\n### Timing with Chrome\n\nChrome, and some other testing tools, use the W3C Resource Timing standard for\nmeasurements. In Chrome developer tools this looks like this:\n\nAgain, here\u2019s how this maps onto a typical HTTP over TLS 1.2 connection, also\nshowing the Resource Timing attribute names:\n\n  * Stalled (fetchStart to domainLookupStart) is the browser waiting to start the connection, e.g. allocating cache on disk, if there are higher priority requests, or if there are already 6 connections open to this host.\n  * Initial connection shown by Chrome is connectStart to connectEnd. Unlike cURL timings, this includes SSL connection setup, so if you want a fair estimate of RTT, this would be Initial connection - SSL. If an existing connection is being reused, then DNS Lookup, Initial connection and SSL won't be shown.\n  * Request sent is connectEnd - requestStart, which should be negligible.\n  * Similarly to cURL, if we subtract the TCP handshake time from TTFB, we can guess the amount of time the server really spent processing (again, we don't have an exact RTT timing, so this is a approximation).\n\n### What are we looking for again?\n\nThese measurements, including TTFB, can be helpful in diagnosing problems, and\nmight help you to delve into a specific problem, but do they actually tell you\nabout how well a website is performing? Ultimately, if you are looking to\nmeasure the experience of users, the time it takes for the first byte of some\nHTML to return isn\u2019t effective. A web page might contain hundreds of images,\nit might have JavaScript and styles that need to load before you can interact.\nTo reflect real user experience, you need to time how long until the web page\nbecomes useful, and to take those measurements from representative sample of\nwhere your users are accessing the site from. And that's a topic for another\nday :)\n\nWe protect entire corporate networks, help customers build Internet-scale\napplications efficiently, accelerate any website or Internet application, ward\noff DDoS attacks, keep hackers at bay, and can help you on your journey to\nZero Trust.\n\nVisit 1.1.1.1 from any device to get started with our free app that makes your\nInternet faster and safer.\n\nTo learn more about our mission to help build a better Internet, start here.\nIf you're looking for a new career direction, check out our open positions.\n\nDiscuss on Hacker News\n\nSpeed & ReliabilityChrome\n\nFollow on X\n\nCloudflare|@cloudflare\n\nRelated posts\n\nJanuary 04, 2024 4:07 PM\n\n## Privacy Pass: upgrading to the latest protocol version\n\nIn this post, we explore the latest changes to Privacy Pass protocol. We are\nalso excited to introduce a public implementation of the latest IETF draft of\nthe Privacy Pass protocol \u2014 including a set of open-source templates that can\nbe used to implement Privacy Pass Origins, Issuers, and Attesters...\n\nBy\n\n  * Thibault Meunier,\n\n  * Cefan Daniel Rubin,\n\n  * Armando Faz-Hern\u00e1ndez\n\nResearch, Privacy Pass, Firefox, Chrome, Privacy\n\nOctober 05, 2023 3:00 PM\n\n## Uncovering the Hidden WebP vulnerability: a tale of a CVE with much bigger\nimplications than it originally seemed\n\nRecently, Google announced a security issue in Google Chrome, titled \"Heap\nbuffer overflow in WebP in Google Chrome.\" Initially, it seemed like just\nanother bug in the popular web browser. However, what we discovered was far\nmore significant and had implications that extended well beyond Chrome...\n\nBy\n\n  * Willi Geiger,\n\n  * Kornel Lesi\u0144ski\n\nVulnerabilities, Chrome, WebP, Security, Swift\n\nOctober 17, 2019 2:00 PM\n\n## Experiment with HTTP/3 using NGINX and quiche\n\nJust a few weeks ago we announced the availability on our edge network of\nHTTP/3, the new revision of HTTP intended to improve security and performance\non the Internet. Everyone can now enable HTTP/3 on their Cloudflare zone...\n\nBy\n\n  * Alessandro Ghedini\n\nNGINX, QUIC, Chrome, Developers, HTTP3\n\nJuly 24, 2018 5:32 PM\n\n## Going Proactive on Security: Driving Encryption Adoption Intelligently\n\nIt's no secret that Cloudflare operates at a huge scale. Cloudflare provides\nsecurity and performance to over 9 million websites all around the world, from\nsmall businesses and WordPress blogs to Fortune 500 companies. That means one\nin every 10 web requests goes through our network....\n\nBy\n\n  * Junade Ali\n\nHTTPS, Chrome, SSL, Support, Security\n\n  * Sales\n  * Enterprise Sales\n  * Become a Partner\n\nContact Sales:\n\n+1 (888) 993-5273\n\n  * Getting Started\n  * Pricing\n  * Case Studies\n  * White Papers\n  * Webinars\n  * Learning Center\n\n  * Community\n  * Community Hub\n  * Project Galileo\n  * Athenian Project\n  * Cloudflare TV\n\n  * Developers\n  * Developer Hub\n  * Developers Discord\n  * Cloudflare Workers\n  * Integrations\n\n  * Tools\n  * Cloudflare Radar\n  * Speed Test\n  * Is BGP Safe Yet?\n  * RPKI Toolkit\n  * Certificate Transparency\n\n  * Support\n  * Support\n  * Cloudflare Status\n  * Compliance\n  * GDPR\n\n  * Company\n  * About Cloudflare\n  * Our Team\n  * Press\n  * Analysts\n  * Careers\n  * Logo\n  * Network Map\n\n\u00a9 2024 Cloudflare, Inc. | Privacy Policy | Terms of Use |Cookie Preferences | Trust & Safety | Trademark\n\n", "frontpage": false}
