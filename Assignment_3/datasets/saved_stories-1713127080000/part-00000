{"aid": "40031367", "title": "Fedora 41 will unify bin and sbin", "url": "https://fedoraproject.org/wiki/Changes/Unify_bin_and_sbin", "domain": "fedoraproject.org", "votes": 39, "user": "rwmj", "posted_at": "2024-04-14 14:35:40", "comments": 19, "source_title": "Changes/Unify bin and sbin - Fedora Project Wiki", "source_text": "Changes/Unify bin and sbin - Fedora Project Wiki\n\n  * Links\n\n    * Get Fedora\n    * Fedora Docs\n    * Fedora Magazine\n    * What Can I Do?\n  * CodeOfConduct\n\n    * Code of Conduct\n  * Subprojects\n\n    * Ambassadors\n    * Community Operations\n    * Design\n    * Documentation\n    * EPEL\n    * Infrastructure\n    * Internationalization\n    * Localization\n    * Marketing\n    * Magazine\n    * Package Maintainers\n    * Quality Assurance\n    * Websites\n    * All projects\n\nLog In\n\n# Changes/Unify bin and sbin\n\nThis page was last edited on 29 February 2024, at 11:09.\n\n  * Page\n  * Discussion\n  * Read\n  * View source\n  * View history\n\nFrom Fedora Project Wiki\n\n< Changes\n\n## Contents\n\n  * 1 Unify /usr/bin and /usr/sbin\n\n    * 1.1 Summary\n    * 1.2 Owner\n    * 1.3 Current status\n    * 1.4 Detailed Description\n    * 1.5 Feedback\n    * 1.6 Benefit to Fedora\n    * 1.7 Scope\n    * 1.8 Upgrade/compatibility impact\n    * 1.9 How To Test\n    * 1.10 User Experience\n    * 1.11 Dependencies\n    * 1.12 Contingency Plan\n    * 1.13 Documentation\n    * 1.14 Release Notes\n\n# \ud83d\udd17 Unify /usr/bin and /usr/sbin\n\n## \ud83d\udd17 Summary\n\nThe /usr/sbin directory becomes a symlink to bin, which means paths like\n/usr/bin/foo and /usr/sbin/foo point to the same place. /bin and /sbin are\nalready symlinks to usr/bin and usr/sbin, so effectively /bin/foo and\n/sbin/foo also point to the same place. /usr/sbin will be removed from the\ndefault $PATH. The same change is also done to make /usr/local/sbin point to\nbin, effectively making /usr/local/bin/foo and /usr/local/sbin/foo point to\nthe same place. The definition of %_sbindir will be changed to %_bindir, so\npackages will start using the new directory after a rebuild without any\nfurther action. Maintainers may stop using %_sbindir, but don't need to.\n\n## \ud83d\udd17 Owner\n\n  * Name: Zbigniew J\u0119drzejewski-Szmek\n  * Email: zbyszek at in.waw.pl\n\n## \ud83d\udd17 Current status\n\n  * Targeted release: Fedora Linux 41\n  * Last updated: 2024-02-29\n  * Announced\n  * Discussion thread\n  * FESCo issue: #3135\n  * Tracker bug: #2267022\n  * Release notes tracker: <will be assigned by the Wrangler>\n\n## \ud83d\udd17 Detailed Description\n\nThe split between /bin and /sbin is not useful, and also unused. The original\nsplit was to have \"important\" binaries statically linked in /sbin which could\nthen be used for emergency and rescue operations. Obviously, we don't do\nstatic linking anymore. Later, the split was repurposed to isolate \"important\"\nbinaries that would only be used by the administrator. While this seems\nattractive in theory, in practice it's very hard to categorize programs like\nthis, and normal users routinely invoke programs from /sbin. Most programs\nthat require root privileges for certain operations are also used when\noperating without privileges. And even when privileges are required, often\nthose are acquired dynamically, e.g. using polkit. Since many years, the\ndefault $PATH set for users includes both directories. With the advent of\nsystemd this has become more systematic: systemd sets $PATH with both\ndirectories for all users and services. So in general, all users and programs\nwould find both sets of binaries.\n\nOne additional use of the /bin\u2014/sbin split is consolehelper. In this approach,\nthe user-facing program (/bin/foo) is a symlink to /bin/consolehelper, which\nis a suid binary that elevates privileges and calls the \"real\" foo (/sbin/foo\nor /usr/libexec/foo). Most uses of consolehelper have been moved to polkit\n(https://fedoraproject.org/wiki/Features/UsermodeMigration), but some users\nremain (https://bugzilla.redhat.com/show_bug.cgi?id=502765). Use of /sbin for\nthe privileged program is incompatible with the proposed merge; those packages\nwill need to be adjusted to move the binary that requires privileges under\n/usr/lib or /usr/libexec (see Scope below).\n\nSince generally all user sessions and services have both directories in $PATH,\nthis split actually isn't used for anything. Its main effect is confusion when\npeople need to use the absolute path and guess the directory wrong. Other\ndistributions put some binaries in the other directory, so the absolute path\nis often not portable. Also, it is very easy for a user to end up with /sbin\nbefore /bin in $PATH, and for an administrator to end up with /bin before\n/sbin in $PATH, causing confusion. If this feature is dropped, the system\nbecame a little bit simpler, which is useful especially for new users, who are\nnot aware of the history of the split.\n\nMany years ago we merged /bin and /usr/bin\n(https://fedoraproject.org/wiki/Features/UsrMove). In some ways that split was\nsimilar: it had historical justification that went away more than a decade\nprior, it was impossible to cleanly categorize programs into the the\ncategories so effectively both parts were needed for boot, and even though it\nwas making the system more complicated for little gain, the split was being\ncarried forward because it was easier to do so than to remove it\n(http://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge). This\nsplit is much less visible, but it's also making the system more complicated\nfor no gain, and removing it is the natural follow-up.\n\n## \ud83d\udd17 Feedback\n\nhttps://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/message/TRQ3I7BDTHG6N7WQEQ7PMK3P6PVWXQMI/\n\n\"Programs in /usr/bin have their documentation in section 1 of the manual,\nwhile programs /usr/sbin are documented in section 8.\"\n\nhttps://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/message/NALSOW35LXN6HZPULMQ46WXNGZO4SYK4/\n\n> \"The manual sections have historical meaning:\n>\n> https://en.wikipedia.org/wiki/Man_page#Manual_sections eg. 1 = general\n> commands 8 = system administration\n>\n> So unless the tools themselves are changing their purpose or are in the\n> wrong section now, the manual sections should stay the same.\"\n\n## \ud83d\udd17 Benefit to Fedora\n\n  * Packagers don't have to think whether to install programs in %_bindir or %_sbindir.\n  * Users don't have to think whether programs are in %_bindir or %_sbindir.\n  * Fedora becomes more compatible with other distributions (for example, we have /sbin/ip while Debian has /bin/ip, and we have /bin/chmem and /bin/isosize, but Debian has /sbin/chmem and /sbin/isosize, and we also have /sbin/{addpart,delpart,lnstat,nstat,partx,ping,rdma,resizepart,ss,udevadm,update-alternatives}, while Debian has those in under /bin, etc.)\n  * Fedora becomes more compatible with Arch, which did the merge a few years ago.\n  * execvp and related functions iterate over fewer directories. This probably doesn't matter for speed, but is a nice simplification when looking at logs or strace output.\n\n## \ud83d\udd17 Scope\n\n  * Proposal owners:\n\n    * Adjust %_sbindir in /usr/lib/rpm/macros (part of rpm package) to evaluate to %_bindir. Packages will be updated automatically during the mass rebuild.\n    * Add a %filetrigger to filesystem package to create symlinks to ../bin/foo for every foo that is uninstalled from /usr/sbin.\n    * Add a %posttrans trigger to filesystem package to check that /usr/sbin only contains symlinks and do ln -fs bin /usr/sbin. (Those scriptlets make it easier to have a smooth transition. At all times, the old paths will still work. After the transition is complete we can drop the scriptlets and provide the /usr/sbin symlink in the filesystem package.)\n    * Adjust systemd package to build with -Dsplit-bin=no.\n    * File a pull request for Packaging Guidelines to stop mentioning %{_sbindir}. The macro will remain defined to avoid breakage of packages which use it.\n\n  * Other developers:\n\n    * Packages which install to hardcoded $DESTDIR/usr/sbin, but then use %{_sbindir} in %files, will need to be adjusted.\n    * Packages which use consolehelper and install the same name under both directories will need to be adjusted to use a different directory. Some of those packages may be retired instead. See list below.\n\n  * Packages using usermode with binaries in both directories:\n\n    * anaconda-live\n    * beesu\n    * chkrootkit\n    * hddtemp\n    * mate-system-log\n    * setuptool\n    * subscription-manager\n    * system-switch-java\n    * xawtv\n\n  * Packages which package a symlink in /usr/sbin that will need to be dropped:\n\n    * opensmtpd\n    * rpcbind\n    * policycoreutils\n    * systemd-udev\n\n  * Release engineering: #11863\n\n  * Policies and guidelines: https://docs.fedoraproject.org/en-US/packaging-guidelines/#_effect_of_the_usrmove_fedora_feature will need to be adjusted (and most likely retitled ;))\n\n  * Trademark approval: N/A (not needed for this Change)\n\n  * Alignment with Community Initiatives: nope\n\n## \ud83d\udd17 Upgrade/compatibility impact\n\nThe change should be mostly invisible for users. While the transition is\nongoing, both sets of paths should work and users should have both directories\nin $PATH. Once the transition is finished, both sets of paths should work, but\nusers will only have /usr/bin in $PATH.\n\n## \ud83d\udd17 How To Test\n\n## \ud83d\udd17 User Experience\n\n## \ud83d\udd17 Dependencies\n\n## \ud83d\udd17 Contingency Plan\n\n  * If the move of a binary of any specific package causes problems, we can create a compat symlink like /usr/sbin/foo \u2192 ../bin/foo using a %postin scriptlet in that package.\n  * If the change is causing problems in general and needs to be reverted, we'd need to undo the changes to macro definitions in rpm and rebuild some or all packages.\n  * Contingency deadline: in principle can be done at any time, but would require a rebuild of some or all affected packages.\n  * Blocks release? no. It is OK if the change is done partially.\n\n## \ud83d\udd17 Documentation\n\nTBD.\n\n## \ud83d\udd17 Release Notes\n\nRetrieved from\n\"https://fedoraproject.org/w/index.php?title=Changes/Unify_bin_and_sbin&oldid=702110\"\n\nCategories:\n\n  * ChangeAcceptedF41\n  * SystemWideChange\n\nCopyright \u00a9 2024 Red Hat, Inc. and others. All Rights Reserved. For comments\nor queries, please contact us.\n\nThe Fedora Project is maintained and driven by the community and sponsored by\nRed Hat. This is a community maintained site. Red Hat is not responsible for\ncontent.\n\n  * This page was last edited on 29 February 2024, at 11:09.\n  * Content is available under Attribution-Share Alike 4.0 International unless otherwise noted.\n\n  * Privacy policy\n  * About Fedora Project Wiki\n  * Disclaimers\n  * Code of Conduct\n  * Sponsors\n  * Legal\n  * Trademark Guidelines\n\n", "frontpage": true}
