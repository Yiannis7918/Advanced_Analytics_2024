{"aid": "40076931", "title": "Asserting Exceptions in Laravel Tests", "url": "https://laravel-news.com/asserting-exceptions-laravel", "domain": "laravel-news.com", "votes": 1, "user": "unripe_syntax", "posted_at": "2024-04-18 14:55:47", "comments": 0, "source_title": "Asserting Exceptions in Laravel Tests - Laravel News", "source_text": "Asserting Exceptions in Laravel Tests - Laravel News\n\nThe PHP Scratchpad: Tinkerwell 4 is available now!\n\nLaravel News\n\nBlog Tutorials Packages Newsletter Podcast\n\nPartners Links Your Account\n\n# Asserting Exceptions in Laravel Tests\n\nPublished on April 18th, 2024 by Paul Redmond\n\nLaravel's recent release of Laravel 11.4 introduced the Exceptions facade,\nwhich adds conveniences around asserting exceptions in Laravel's exception\nhandler. Before this release, I would typically use the\n$this->withoutExceptionHandling() to assert that a specific exception happened\nduring an HTTP test:\n\n    \n    \n    use App\\Exceptions\\WelcomeException;\n    \n    $this->withoutExceptionHandling();\n    \n    try {\n    \n    $this->get('/');\n    \n    } catch (WelcomeException $e) {\n    \n    $this->assertEquals('Woops, there was an issue with your request!', $e->getMessage());\n    \n    return;\n    \n    }\n    \n    $this->fail(sprintf('The expected \"%s\" exception was not thrown.', WelcomeException::class));\n\nWhen you expect a request to not throw any exceptions, using\nwithoutExceptionHandling cuts out the middleman when you're debugging why an\nerror is happening when you don't expect it. The above code is tedious to\nwrite, because it manually captures the exception, makes assertions about the\nexception, and calls return to avoid the manual $this->fail() call. The manual\nfailure will catch situations when the test doesn't throw an exception when\nexpected.\n\nIf $this->fail() is called in the above scenario, here's what the output would\nlook like:\n\n    \n    \n    $ phpunit\n    \n    There was 1 failure:\n    \n    1) Tests\\Feature\\ExampleTest::test_the_application_returns_a_successful_response\n    \n    The expected \"App\\Exceptions\\WelcomeException\" exception was not thrown.\n    \n    /app/tests/Feature/ExampleTest.php:33\n\n## #Laravel's Exceptions Facade\n\nLet's look at how the new Exceptions facade can simplify our test; the first\nexample, rewritten, would look as follows:\n\n    \n    \n    use Illuminate\\Support\\Facades\\Exceptions;\n    \n    Exceptions::fake();\n    \n    $this->get('/');\n    \n    Exceptions::assertReported(function (WelcomeException $e): bool {\n    \n    return $e->getMessage() === \"Woops, there was an issue with your request!\";\n    \n    });\n\nUsing the Exceptions facade gives us the bonus of not having to capture an\nexception to assert things manually. Said another way, the test can keep\nLaravel's exception handler in place but still be able to assert exceptions\nthat happened during a request.\n\nIf we want to be sure that a test doesn't throw a specific exception or\ndoesn't throw any exceptions, period, the new facade has our back:\n\n    \n    \n    Exceptions::assertNotReported(WelcomeException::class);\n    \n    Exceptions::assertNothingReported();\n\nIf the exception handler does not report the WelcomeException, the test output\nwould give us a nicely formatted message:\n\n    \n    \n    $ phpunit\n    \n    There was 1 failure:\n    \n    1) Tests\\Feature\\ExampleTest::test_the_application_returns_a_successful_response\n    \n    The expected [App\\Exceptions\\WelcomeException] exception was not reported.\n\nWhile there may be times when you don't want to fake Laravel's exception\nhandler, when testing edge cases, the new Exceptions facade is tremendously\nhelpful and cleans up our code:\n\n    \n    \n    Exceptions::assertReported(WelcomeException::class);\n    \n    Exceptions::assertReportedCount($count);\n    \n    Exceptions::assertNotReported(WelcomeException::class);\n    \n    Exceptions::assertNothingReported();\n    \n    Exceptions::throwFirstReported();\n\nTo learn more about the Exceptions facade, check out Laravel\u2019s documentation.\n\nPaul Redmond\n\nStaff writer at Laravel News. Full stack web developer and author.\n\nX GitHub\n\nFiled in:\n\nLaravel Tutorials\n\n## Laravel Newsletter\n\nJoin 40k+ other developers and never miss out on new tips, tutorials, and\nmore.\n\n## Laravel Jobs\n\nExplore hundreds of open positions today.\n\nView all jobs\n\nSoftware Engineer\n\nSenior Laravel & Vue.js Developer (SEO)\n\nSenior Laravel Engineers \u2192 Roll with high growth team\n\nFull stack Laravel developer\n\nSenior Laravel Developer for UK-based Seed-Funded Startup\n\nParagraph\n\nManage your Laravel app as if it was a CMS \u2013 edit any text on any page or in\nany email without touching Blade or language files.\n\nVisit Paragraph\n\n## Partners\n\nView all \u2192\n\n### Laravel Forge\n\nEasily create and manage your servers and deploy your Laravel applications in\nseconds.\n\nLaravel Forge\n\n### Tinkerwell\n\nThe must-have code runner for Laravel developers. Tinker with AI,\nautocompletion and instant feedback on local and production environments.\n\nTinkerwell\n\n### No Compromises\n\nJoel and Aaron, the two seasoned devs from the No Compromises podcast, are now\navailable to hire for your Laravel project. \u2b27 Flat rate of $7500/mo. \u2b27 No\nlengthy sales process. \u2b27 No contracts. \u2b27 100% money back guarantee.\n\nNo Compromises\n\n### Kirschbaum\n\nProviding innovation and stability to ensure your web application succeeds.\n\nKirschbaum\n\n### Shift\n\nRunning an old Laravel version? Instant, automated Laravel upgrades and code\nmodernization to keep your applications fresh.\n\nShift\n\n### Bacancy\n\nSupercharge your project with a seasoned Laravel developer with 4-6 years of\nexperience for just $2500/month. Get 160 hours of dedicated expertise & a\nrisk-free 15-day trial. Schedule a call now!\n\nBacancy\n\n### Lucky Media\n\nBespoke software solutions built for your business. We \u2665 Laravel\n\nLucky Media\n\n### Lunar: Laravel E-Commerce\n\nE-Commerce for Laravel. An open-source package that brings the power of modern\nheadless e-commerce functionality to Laravel.\n\nLunar: Laravel E-Commerce\n\n### LaraJobs\n\nThe official Laravel job board\n\nLaraJobs\n\n### All Green\n\nAll Green is a SaaS test runner that can execute your whole Laravel test suite\nin mere seconds so that you don't get blocked \u2013 you get feedback almost\ninstantly and you can deploy to production very quickly.\n\nAll Green\n\n### Larafast: Laravel SaaS Starter Kit\n\nLarafast is a Laravel SaaS Starter Kit with ready-to-go features for Payments,\nAuth, Admin, Blog, SEO, and beautiful themes. Available with VILT and TALL\nstacks.\n\nLarafast: Laravel SaaS Starter Kit\n\n### SaaSykit: Laravel SaaS Starter Kit\n\nSaaSykit is a Laravel SaaS Starter Kit that comes with all features required\nto run a modern SaaS. Payments, Beautiful Checkout, Admin Panel, User\ndashboard, Auth, Ready Components, Stats, Blog, Docs and more.\n\nSaaSykit: Laravel SaaS Starter Kit\n\n### Rector\n\nYour partner for seamless Laravel upgrades, cutting costs, and accelerating\ninnovation for successful companies\n\nRector\n\n## The latest\n\nView all \u2192\n\n### Asserting Exceptions in Laravel Tests\n\nRead article\n\n### Reversible Form Prompts and a New Exceptions Facade in Laravel 11.4\n\nRead article\n\n### Basset is an alternative way to load CSS & JS assets\n\nRead article\n\n### Integrate Laravel with Stripe Connect Using This Package\n\nRead article\n\n### The Random package generates cryptographically secure random values\n\nRead article\n\n### Automatic Blade Formatting on Save in PhpStorm\n\nRead article\n\n## Subscribe to our newsletter\n\nand follow us on\n\nFacebook Instagram X Linkedin Telegram Youtube Threads\n\nLaravel Newsletter Laravel Links Laravel Packages Laravel Tutorials Laravel\nEvents Popular Packages Laravel Releases Partners Advertising Laravel Jobs\nContact Us Your account\n\n\u00a9 2012 - 2024 Laravel News A division of dotdev inc.\n\nColophon / About\n\n## Laravel News\n\nBlog Tutorials Packages Podcast Newsletter Community Links Partners\n\nYour Account Advertising\n\n## Search Articles\n\nOr try paginated search \u2192\n\n", "frontpage": false}
