{"aid": "40032631", "title": "Testing Font Code", "url": "https://www.redblobgames.com/blog/2024-04-13-testing-font-code/", "domain": "redblobgames.com", "votes": 1, "user": "ingve", "posted_at": "2024-04-14 17:17:26", "comments": 0, "source_title": "Testing font code", "source_text": "Testing font code\n\n# Testing font code\n\nfrom Red Blob Games\n\n13 Apr 2024\n\nEarlier this year I was trying to improve font rendering in some of my C++\nprojects, and that led me down a rabbit hole of learning signed distance field\n(SDF) font rendering. I wanted to try out the SDF fonts in a real project. I\noccasionally help with Galactic Assault Squad^[1] (GAS), especially \u201cengine\u201d\ncode, so for Week 6 I decided to try SDF fonts there.\n\nFonts rendered in the game world\n\nThe first day or two I was navigating the code to see how it was structured.\nThen I could figure out where I could add the SDF font renderer. I tested\nfirst by writing new C++ code and reusing the same shader from my JS\nexperiments. It was a lot of hackery, including global variables scattered\nthroughout, but I got some text on the screen:\n\nFont atlas\n\nThe next step was to read the font atlas, which says where in the image each\nletter is. I started heading down a rabbit hole thinking about how best\noptimize that file format and code, but remembered that this is just an hacky\nproof of concept right now. I stopped trying to optimize and focused on\ngetting something working.\n\nOne glyph extracted from the font atlas\n\nAlong the way I ran into some differences in coordinate systems between my JS\ncode and the C++ code:\n\nBuggy font rendering\n\nBut that\u2019s fixed by flipping things upside down a few times. The next goal was\nto draw text in the game world. I decided to draw labels on roads:\n\nText above objects\n\nBut it might also be interesting for text to be on the ground, underneath\nother objects (note that this was tested with a different font):\n\nText below objects\n\nI also made a demo of text trailing behind a player:\n\nFake sponsorship message\n\nOne thing I learned was that the text shadow scaling I put in place for my\nstandalone experiments were not suitable when there\u2019s a busy game in the\nbackground. Compared to my previous experiments, I needed the small text to\nhave a larger shadow and the large text to have a smaller shadow. That\u2019s\nexactly the reason I want to test things in a real project. Sometimes it\u2019s not\nobvious from a standalone experiment.\n\nI compared the new renderer to the existing one:\n\nText comparison\n\nI think the SDF renderer is really nice at large sizes but not necessarily\nbetter at small sizes. The main value of a new font renderer would not be in\nmaking the rendering better, but in allowing new ways to render fonts\n(shadows, glows, distortions, and other effects).\n\nMy goal for Week 6 was to try the SDF fonts in a real game project. I think\nthat went well. In Week 7 I looked at what it would take to properly integrate\nthe code into the game. Right now the development priority is combat and\nprogression systems, not font rendering. Until we have some text to render in\nnew ways, replacing the font renderer has low value. If it were easy to\nintegrate, I could justify cleaning up the hacky proof of concept. However I\nconcluded that it would take some restructuring of other rendering code. That\nmakes it a high cost and low value. It\u2019s probably best to wait until we\u2019re\nrefactoring for other reasons (lowering the cost) or until we want to render\ntext with effects (raising the value).\n\nIn a real project, I think it\u2019s wise to evaluate the cost/benefit to the\nplayers, not adopt new things just because the tech is cool. So maybe Galactic\nAssault Squad^[2] will get a new font renderer in the future, but not today.\n\nWith that, I am finished with my font rendering experiments. I have a\ndifferent project to work on next.\n\nEmail me redblobgames@gmail.com, or tweet @redblobgames, or comment:\n\n### Endnotes\n\n  1. [1]: https://gasgame.net/\n  2. [2]: https://gasgame.net/\n\nCopyright \u00a9 2024 Red Blob Games RSS Feed\n\nCreated 13 Apr 2024; Last modified: 14 Apr 2024\n\n", "frontpage": false}
