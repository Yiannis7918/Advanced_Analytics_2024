{"aid": "39966858", "title": "Zx 8.0", "url": "https://github.com/google/zx/releases/tag/8.0.0", "domain": "github.com/google", "votes": 2, "user": "medv", "posted_at": "2024-04-08 06:39:53", "comments": 0, "source_title": "Release 8.0.0 \u00b7 google/zx", "source_text": "Release 8.0.0 \u00b7 google/zx \u00b7 GitHub\n\nSkip to content\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\ngoogle / zx Public\n\n  * Notifications\n  * Fork 997\n  * Star 40.7k\n\n# 8.0.0\n\nantonmedv released this 05 Apr 23:27\n\n\u00b7 4 commits to main since this release\n\n8.0.0\n\n7fa9bfc\n\nWe are thrilled to announce the release of zx v8.0.0! \ud83c\udf89\n\nWith this release, we have introduced a lot of new features, improvements, and\nbug fixes. We have also made some breaking changes, so please read the\nfollowing release notes carefully.\n\n### \ud83d\ude80 New Shiny Features\n\nSquashed deps: we use esbuild with custom plugins to forge js bundles and dts-\nbundle-generator for typings ^ 2acb0f, #722\n\nMore safety, more stability and significantly reduced installation time. Zx\nnow is ~20x smaller.\n\n    \n    \n    npx zx@8.0.0 npm install zx@8.0.0\n\nOptions presets are here. To implement this, we have also completely\nrefactored the zx core, and now it's available as a separate package \u2013 zurk ^\naeec7a, #733, #600\n\n    \n    \n    const $$ = $({quiet: true}) await $$`echo foo` $({nothrow: true})`exit 1`\n\nWe have introduced $.sync() API ^ 1f8c8b, #738, #681, 1d8aa9, #739\n\n    \n    \n    import {$} from 'zx' const { output } = $.sync`echo foo` // foo\n\nYou can also override the internal API to implement pools, test mocking, etc.\n\n    \n    \n    $.spawnSync = () => {} // defaults to `child_process.spawnSync`\n\nThe input option is now available to pass data to the command. ^ b38972, #736\n\n    \n    \n    const p1 = $({ input: 'foo' })`cat` const p2 = $({ input: Readable.from('bar') })`cat` const p3 = $({ input: Buffer.from('baz') })`cat` const p4 = $({ input: p3 })`cat` const p5 = $({ input: await p3 })`cat`\n\nAbortController has been introduced to abort the command execution. It's\navailable via the ac option. ^ fa4a7b, #734, #527\n\n    \n    \n    const ac = new AbortController() const p = $({ ac })`sleep 9999` setTimeout(() => ac.abort(), 100)\n\nIf not specified, the default instance will be used. Abortion trigger is also\navailable via PromiseResponse:\n\n    \n    \n    const p = $`sleep 9999` setTimeout(() => p.abort(), 100)\n\nkill method is exposed now. To terminate any (not only zx starter) process:\n\n    \n    \n    import { kill } from 'zx' await kill(123) await kill(123, 'SIGKILL')\n\nBtw, we have replaced ps-tree with @webpod/ps & @webpod/ingrid, and exposed ps\nutil:\n\n    \n    \n    import {ps} from 'zx' const children = await ps.tree(123) /** [ {pid: 124, ppid: 123}, {pid: 125, ppid: 123} ] */ const children2 = await ps.tree({pid: 123, recursive: true}) /** [ {pid: 124, ppid: 123}, {pid: 125, ppid: 123}, {pid: 126, ppid: 124}, {pid: 127, ppid: 124}, {pid: 128, ppid: 124}, {pid: 129, ppid: 125}, {pid: 130, ppid: 125}, ] */\n\nIntroduced $.postfix option. It's like a $.prefix, but for the end of the\ncommand. ^ fb9554, #756, #536\n\n    \n    \n    import {$} from 'zx' $.postfix = '; exit $LastExitCode' // for PowerShell compatibility\n\nminimist API exposed ^ #661\n\n    \n    \n    import { minimist } from 'zx' const argv = minimist(process.argv.slice(2), {})\n\nFixed npm package name pattern on --install mode ^ 956dcc, #659, #660, #663\n\n    \n    \n    import '@qux/pkg' // valid import '@qux/pkg/entry' // was invalid before and valid now\n\n### \u26a0\ufe0f Breaking changes\n\n> We've tried our best to avoid them, but it was necessary.\n\n  1. $.verbose is set to false by default, but errors are still printed to stderr. Set $.quiet = true to suppress all output. ^ cafb90, #745, #569\n    \n        $.verbose = true // everything works like in v7 $.quite = true // to completelly turn off logging\n\n  2. ssh API was dropped. Install webpod package instead. ^ 8925a1, #750\n    \n        // import {ssh} from 'zx' \u2193 import {ssh} from 'webpod' const remote = ssh('user@host') await remote`echo foo`\n\n  3. zx is not looking for powershell anymore, on Windows by default. If you still need it, use the usePowerShell helper: ^ 24dcf3, #757\n    \n        import { usePowerShell, useBash } from 'zx' usePowerShell() // to enable powershell useBash() // switch to bash, the default\n\n  4. Process cwd synchronization between $ invocations is disabled by default. This functionality is provided via an async hook and can now be controlled directly. ^ d79a63, #765\n    \n        import { syncProcessCwd } from 'zx' syncProcessCwd() // restores legacy v7 behaviour\n\n### \ud83e\uddf0 Other Improvements\n\n  * added dev (snapshot publish) releases 0c97b9 #723\n  * tsconfig: dropped lib DOM fe0356 #735, #619, #722)\n  * implemented ProcessPromise.valueOf() to simplify value comparisons 0640b8, #737, #690\n  * enhanced --install API: use depkeek for deps extraction 1a03a6\n  * removed --experimental toggle, all APIs are available by default 8a7a8f, #751\n  * added minute support in duration b02fd5, #703, #704\n  * enhanced stack extraction to support bun 2026d4, #752\n  * fixed spinner issue on weird TTY 1124e3, #755, #607\n  * migrated tests to native node:test cd1835\n\n36 people reacted\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
