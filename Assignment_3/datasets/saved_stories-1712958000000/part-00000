{"aid": "40014124", "title": "E2E LLM finetuning on a single 24GB GPU", "url": "https://github.com/jdecourval/chef-ai", "domain": "github.com/jdecourval", "votes": 1, "user": "jdecourval", "posted_at": "2024-04-12 15:38:04", "comments": 0, "source_title": "GitHub - jdecourval/chef-ai: E2E LLM finetuning on a single 24GB GPU", "source_text": "GitHub - jdecourval/chef-ai: E2E LLM finetuning on a single 24GB GPU\n\nSkip to content\n\nSign in\n\n# Search code, repositories, users, issues, pull requests...\n\nSearch syntax tips\n\nSign in\n\nSign up\n\nYou signed in with another tab or window. Reload to refresh your session. You\nsigned out in another tab or window. Reload to refresh your session. You\nswitched accounts on another tab or window. Reload to refresh your session.\nDismiss alert\n\njdecourval / chef-ai Public\n\n  * Notifications\n  * Fork 0\n  * Star 0\n\nE2E LLM finetuning on a single 24GB GPU\n\n### License\n\nApache-2.0 license\n\n0 stars 0 forks Branches Tags Activity\n\nStar\n\nNotifications\n\n# jdecourval/chef-ai\n\nThis commit does not belong to any branch on this repository, and may belong\nto a fork outside of the repository.\n\n1 Branch\n\n0 Tags\n\n## Folders and files\n\nName| Name| Last commit message| Last commit date  \n---|---|---|---  \n  \n## Latest commit\n\njdecourvalAdd LICENCE62785b1 \u00b7\n\n## History\n\n94 Commits  \n  \n### db\n\n|\n\n### db\n\n| Remove one non-generic register_adapter from db.py  \n  \n### finetuning\n\n|\n\n### finetuning\n\n| Fix finetuning.py main  \n  \n### indexer\n\n|\n\n### indexer\n\n| Don't index duplicated documents  \n  \n### inference\n\n|\n\n### inference\n\n| Disable k-cache quantization by default for llama_cpp_server.py  \n  \n### model\n\n|\n\n### model\n\n| Take notes of documents not yielding trainings so that they can be sk...  \n  \n### postprocessing\n\n|\n\n### postprocessing\n\n| Cleanup  \n  \n### spider\n\n|\n\n### spider\n\n| Fix bytes/str handling in spider.py  \n  \n### trainer\n\n|\n\n### trainer\n\n| Fix some question lists being truncated in summarizing_trainer.py  \n  \n### utils\n\n|\n\n### utils\n\n| Make sure generators are exhausted  \n  \n### .gitignore\n\n|\n\n### .gitignore\n\n| Initial  \n  \n### LICENSE\n\n|\n\n### LICENSE\n\n| Add LICENCE  \n  \n### README.md\n\n|\n\n### README.md\n\n| Update installation instructions  \n  \n### main.py\n\n|\n\n### main.py\n\n| Move LLM engines to their own files  \n  \n### requirements.txt\n\n|\n\n### requirements.txt\n\n| Update requirements.txt  \n  \n## Repository files navigation\n\n# chef-ai\n\nDownload here: https://huggingface.co/jdecourval/chef-ai\n\nThis repository is meant as an exercise for finetuning a transformer based\nlarge language model. The goal is to finetune a small model as a cooking\nassistant, and be able to do so on a single 24GB. For an extra challenge, I\nused an AMD GPU (7900xtx).\n\nAll finetuning steps are demonstrated. The application:\n\n  * Scrapes data sources on the internet.\n  * Indexes that information into a sqlite database.\n  * Uses llm based subpipelines to generate a chat-formatted dataset from the database.\n  * Performs efficient supervised finetuning from the dataset.\n  * Merges the resulting LoRA into the base model.\n\nTo avoid being blamed for scrapping, the source's base url (of the format\nhttps://mysource.com) is not included in this repo, and must be specified\nthrough the SPIDER_BASE_URL environment variable, or spider.py must be adapted\nfor your own different source. You must figure this out yourself.\n\nTo execute, install the requirements plus pytorch, and bitsandbytes and run\nmain.py followed by the path to an inference model supported by llama.cpp or\nexllama. Don't forget to define SPIDER_BASE_URL as explained above. To use\nllama.cpp's server, you must also define the LLAMACPP_BIN_PATH environment\nvariable to point to llama.cpp's bin folder. Example:\n\n    \n    \n    export SPIDER_BASE_URL=\"https://redacted.com\" export LLAMACPP_BIN_PATH=\"/home/me/llamacpp/bin\" python -m venv venv source venv/bin/activate pip install --upgrade --pre torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/rocm6.0 git clone -b rocm_enabled https://github.com/ROCmSoftwarePlatform/bitsandbytes.git cd bitsandbytes make hip pip install . cd - pip install -r requirements.txt python main.py inference-model.gguf\n\nThe whole thing takes a few days to complete on my computer, but every step is\nresumable. In other words, the process can be interrupted at any time, and\nwill (roughly) pick up where it was when it is restarted. With a single 24GB\nGPU, you can really only expect to be able to finetune 7B parameters models.\nYou can use something larger for the inference model however, but keep in mind\nthe application will probably use the model close to 10000 times over its\nentire course, so it needs to be fast. Smaller model are faster not only\nbecause of their lower compute requirements, but also because this repository\nuses continuous batching.\n\n## About\n\nE2E LLM finetuning on a single 24GB GPU\n\n### Resources\n\nReadme\n\n### License\n\nApache-2.0 license\n\nActivity\n\n### Stars\n\n0 stars\n\n### Watchers\n\n1 watching\n\n### Forks\n\n0 forks\n\nReport repository\n\n## Releases\n\nNo releases published\n\n## Packages 0\n\nNo packages published\n\n## Languages\n\n  * Python 100.0%\n\n## Footer\n\n\u00a9 2024 GitHub, Inc.\n\nYou can\u2019t perform that action at this time.\n\n", "frontpage": false}
