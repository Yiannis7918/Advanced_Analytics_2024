{"aid": "40023290", "title": "Linux 6.10 SLUB Optimization to Reduce Memory Consumption in Extreme Scenarios", "url": "https://www.phoronix.com/news/Linux-6.10-SLUB-Optimization", "domain": "phoronix.com", "votes": 2, "user": "LinuxBender", "posted_at": "2024-04-13 14:14:55", "comments": 0, "source_title": "Linux 6.10 SLUB Optimization To Reduce Memory Consumption In Extreme Scenarios - Phoronix", "source_text": "Linux 6.10 SLUB Optimization To Reduce Memory Consumption In Extreme Scenarios\n- Phoronix\n\n  * Articles & Reviews\n  * News Archive\n  * Forums\n  * Premium Ad-Free\n  * Contact\n  * Popular Categories\n  * Close\n\n  * Articles & Reviews\n  * News Archive\n  * Forums\n  * Premium\n  * Contact\n  * Categories\n\nComputers Display Drivers Graphics Cards Linux Gaming Memory Motherboards\nProcessors Software Storage Operating Systems Peripherals\n\n# Linux 6.10 SLUB Optimization To Reduce Memory Consumption In Extreme\nScenarios\n\nWritten by Michael Larabel in Linux Kernel on 12 April 2024 at 10:38 AM EDT. 5\nComments\n\nA patch to the Linux kernel's SLUB allocator has been queued ahead of the\nupcoming Linux 6.10 merge window to help reduce memory consumption in extreme\nscenarios.\n\nThe patch from Huawei engineer Chen Jun will help with lowering memory\nconsumption in extreme cases. Chen Jun explained of the work:\n\n> When kmalloc_node() is called without __GFP_THISNODE and the target node\n> lacks sufficient memory, SLUB allocates a folio from a different node other\n> than the requested node, instead of taking a partial slab from it.\n>\n> However, since the allocated folio does not belong to the requested node, on\n> the following allocation it is deactivated and added to the partial slab\n> list of the node it belongs to.\n>\n> This behavior can result in excessive memory usage when the requested node\n> has insufficient memory, as SLUB will repeatedly allocate folios from other\n> nodes without reusing the previously allocated ones.\n>\n> To prevent memory wastage, when a preferred node is indicated (not\n> NUMA_NO_NODE) but without a prior __GFP_THISNODE constraint:\n>\n> 1) try to get a partial slab from target node only by having __GFP_THISNODE in pc.flags for get_partial() 2) if 1) failed, try to allocate a new slab from target node with GFP_NOWAIT | __GFP_THISNODE opportunistically. 3) if 2) failed, retry with original gfpflags which will allow get_partial() try partial lists of other nodes before potentially allocating new page from other nodes\n\nWhen testing on a QEMU VM with four NUMA nodes each having 1GB of memory and\ncarrying out a simple test case, Chen found that the number of allocated\nobjects via /proc/slabinfo dropped from 13,519,712 down to 4,200,768 objects.\nOr just 31% the original number of allocated objects as found with current\nLinux kernels in this extreme case.\n\nThe patch is in the SLAB.git repository's \"for-next\" branch ahead of the Linux\n6.10 merge window coming in mid-May.\n\n5 Comments\n\nTweet\n\nRelated News\n\nLinux 6.10 To Account For NUMA Node When Allocating Per-CPU Cpumasks\n\nLinux 6.8.5 & Other Stable Kernel Updates Due To Native BHI Vulnerability\n\nLinux 6.10 AES-XTS For Disk/File Encryption As Much As ~155% Faster For AMD\nZen 4 CPUs\n\nLinux 6.9-rc3 Released With Many Bcachefs Patches\n\nNew EEVDF Linux Scheduler Patches Make It Functionally \"Complete\"\n\nThe Linux Kernel Begins Preparing For Rust 1.78 Upgrade\n\nAbout The Author\n\nMichael Larabel is the principal author of Phoronix.com and founded the site\nin 2004 with a focus on enriching the Linux hardware experience. Michael has\nwritten more than 20,000 articles covering the state of Linux hardware\nsupport, Linux performance, graphics drivers, and other topics. Michael is\nalso the lead developer of the Phoronix Test Suite, Phoromatic, and\nOpenBenchmarking.org automated benchmarking software. He can be followed via\nTwitter, LinkedIn, or contacted via MichaelLarabel.com.\n\nPopular News This Week\n\nKDE On The Importance Of Wayland Explicit Sync\n\nUbuntu Maker Canonical Announces New Collaboration With Qualcomm\n\nx86-64-v5? Questions Arise Over The Future Of x86-64 Micro-Architecture\nFeature Levels\n\nNetplan 1.0 Is Ready To Go For Ubuntu 24.04 LTS\n\nArch Linux Increasing Its vm.max_map_count To Help Steam Play Games & Other\nSoftware\n\nNew EEVDF Linux Scheduler Patches Make It Functionally \"Complete\"\n\nWine 9.6 Adds Support For Advanced AVX Features In Register Contexts\n\nGNOME Improving Integration With systemd-homed, Mockups For An OS Installer\n\nLatest Linux News\n\nLinux 6.10 To Account For NUMA Node When Allocating Per-CPU Cpumasks\n\nMesa 24.1 Zink Lands \"Super Fast\" Merge Request To Optimize IO\n\nFedora 41 Looks To \"-O3\" Optimizations For Its Python Build\n\nKDE's Busy Week With Landing Explicit Sync & Many Other Changes\n\nAPT 2.9 Released: Debian's APT 3.0 To Have A New UI With Colors, Columnar\nDisplay & More\n\nXWayland 24.1 Planned For Release Next Month With Explicit Sync & Other\nFeatures\n\nKDE Frameworks 6.1 Released With Many Improvements & Fixes\n\nLinux 6.10 SLUB Optimization To Reduce Memory Consumption In Extreme Scenarios\n\nLPython 0.21 Released For Alpha-Stage Python AOT Compiler\n\nSDL 3.0 Will Now Prefer PipeWire Over PulseAudio\n\nShow Your Support, Go Premium\n\nPhoronix Premium allows ad-free access to the site, multi-page articles on a\nsingle page, and other features while supporting this site's continued\noperations.\n\nLatest Featured Articles\n\nUbuntu 24.04 Brings Some Performance Gains For AMD Threadripper 7980X /\nSystem76 Thelio Major\n\nIntel Announces Gaudi 3 AI Accelerator, Intel Xeon 6 Brand\n\nAMD Radeon Linux Gaming Performance At Parity Between KDE Plasma 6.0 X11 vs.\nWayland\n\nIntel Xeon Max Sees Some Performance Gains For OpenVINO & ONNX With Linux 6.9\n\nCrucial T705 PCIe 5.0 NVMe SSD On Linux\n\nSupport Phoronix\n\nThe mission at Phoronix since 2004 has centered around enriching the Linux\nhardware experience. In addition to supporting our site through\nadvertisements, you can help by subscribing to Phoronix Premium. You can also\ncontribute to Phoronix through a PayPal tip or tip via Stripe.\n\nPhoronix Media\n\n  * Contact\n  * Michael Larabel\n  * OpenBenchmarking.org\n\nPhoronix Premium\n\n  * Support Phoronix\n  * While Having Ad-Free Browsing,\n  * Single-Page Article Viewing\n\nShare\n\n  * Facebook\n  * Twitter\n\n  * Legal Disclaimer, Privacy Policy, Cookies | | Contact\n\n  * Copyright \u00a9 2004 - 2024 by Phoronix Media.\n\n  * All trademarks used are properties of their respective owners. All rights reserved.\n\n", "frontpage": false}
