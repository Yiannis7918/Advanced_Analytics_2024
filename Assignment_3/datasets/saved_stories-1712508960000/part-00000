{"aid": "39959946", "title": "Did any processor implement an integer square root instruction?", "url": "https://retrocomputing.stackexchange.com/questions/29787/did-any-processor-implement-an-integer-square-root-instruction", "domain": "retrocomputing.stackexchange.com", "votes": 15, "user": "rwallace", "posted_at": "2024-04-07 10:55:10", "comments": 0, "source_title": "Did any processor implement an integer square root instruction?", "source_text": "history - Did any processor implement an integer square root instruction? -\nRetrocomputing Stack Exchange\n\n#### Stack Exchange Network\n\nStack Exchange network consists of 183 Q&A communities including Stack\nOverflow, the largest, most trusted online community for developers to learn,\nshare their knowledge, and build their careers.\n\nVisit Stack Exchange\n\nRetrocomputing\n\nTeams\n\nQ&A for work\n\nConnect and share knowledge within a single location that is structured and\neasy to search.\n\nLearn more about Teams\n\n# Did any processor implement an integer square root instruction?\n\nAsk Question\n\nAsked 2 days ago\n\nModified yesterday\n\nViewed 3k times\n\nThis question shows research effort; it is useful and clear\n\n20\n\nSave this question.\n\nShow activity on this post.\n\nHas any processor ever implemented an integer square root instruction?\nObviously, floating-point square root instructions are quite common, but I've\nnever seen one specifically for integers.\n\nOne close candidate I know of is the Nintendo DS, which contained a memory-\nmapped integer divider/square rooter. This was helpful for 3D calculations,\ngiven that its ARM processor had no FPU or hardware divider. However, it's not\na native processor instruction.\n\n  * history\n  * instruction-set\n\nShare\n\nCC BY-SA 4.0\n\nImprove this question\n\nFollow this question to receive notifications\n\nedited yesterday\n\nRaffzahn\n\n223k2222 gold badges631631 silver badges918918 bronze badges\n\nasked 2 days ago\n\nv-robv-rob\n\n65744 silver badges1010 bronze badges\n\n5\n\n  * tough one; square rooting is something that you don't want to do combinatorically in a single clock cycle, or else your maximum clock rate will go dooooown, and it uses the same algorithmic components that an integer multiply and division need. This makes it a prime candidate for implementation in iterative microcode. Now, what's the difference between a CPU that implements an isqrt instruction in microcode vs software that implements a isqrt function on a CPU that has no isqrt instruction, precisely?\n\n\u2013 Marcus M\u00fcller\n\nyesterday\n\n  * 2\n\nNon-iterative implementation for large input sizes get unhandy very quickly,\nand for small sizes, simple lookup tables might be quite performant. What is\nthe minimum input size you would consider an implementation?\n\n\u2013 Marcus M\u00fcller\n\nyesterday\n\n  * By \"processor\" do you mean microprocessor? Or do you intend to include mainframes, DSPs, etc?\n\n\u2013 DrSheldon\n\nyesterday\n\n  * @DrSheldon I meant it in a pretty general sense of the word. If it's got an instruction set that includes an isqrt instruction, it'll probably do :)\n\n\u2013 v-rob\n\nyesterday\n\n  * I can't imagine a huge demand for intsqrt. Normally, if your task needs sqrt you probably want float arithmetic. But I guess intsqrt is useful if you're doing fixed-point arithmetic, or implementing a bare-bones floating-point package.\n\n\u2013 PM 2Ring\n\nyesterday\n\nAdd a comment |\n\n## 3 Answers 3\n\nReset to default\n\nThis answer is useful\n\n22\n\nSave this answer.\n\nShow activity on this post.\n\nYes. The Harris RTX 2000 Forth CPU offered a multi-step square root\ninstruction, as did its military-grade sibling, the RTX 2010. There may have\nbeen others, but that is the one I know of.\n\nSee: https://users.ece.cmu.edu/~koopman/stack_computers/sec4_5.html\n\nShare\n\nCC BY-SA 4.0\n\nImprove this answer\n\nFollow this answer to receive notifications\n\nanswered yesterday\n\nRichFRichF\n\n9,03644 gold badges3030 silver badges5656 bronze badges\n\n3\n\n  * Nice, do you know any more detailed description?\n\n\u2013 Raffzahn\n\nyesterday\n\n  * 1\n\n@Raffzahn Not off the top of my head. But I do see when searching, you should\nspecify Harris as part of the search. Otherwise the results are mostly pages\nrelating to a series of NVidia GPU boards. As far as I can tell, there is no\ncommonality besides the general model number.\n\n\u2013 RichF\n\nyesterday\n\n  * 4\n\nInteresting; according to the reference manual\n(users.ece.cmu.edu/~koopman/forth/...), it's an iterated square root where you\nhave to run 1 setup instruction and then 15 step instructions to get the final\nanswer. I've seen that done for division on other processors. And of course it\nwould be a Forth CPU that would have such an esoteric instruction, heh.\n\n\u2013 v-rob\n\nyesterday\n\nAdd a comment |\n\nThis answer is useful\n\n25\n\nSave this answer.\n\nShow activity on this post.\n\nIs 1946 retro enough?\n\nFrom Wikipedia:\n\n> ENIAC used four of the accumulators (controlled by a special multiplier\n> unit) to perform up to 385 multiplication operations per second; five of the\n> accumulators were controlled by a special divider/square-rooter unit to\n> perform up to 40 division operations per second or three square root\n> operations per second.\n\nENIAC accumulators operated on decimal integers.\n\nShare\n\nCC BY-SA 4.0\n\nImprove this answer\n\nFollow this answer to receive notifications\n\nanswered yesterday\n\nJohn DotyJohn Doty\n\n2,38477 silver badges1313 bronze badges\n\nAdd a comment |\n\nThis answer is useful\n\n11\n\nSave this answer.\n\nShow activity on this post.\n\nIt's not that easy.\n\nThe most efficient method to calculate square root is to calculate\ninverse/reciprocal of the square root using Newton-Raphson iterations, and\nthen multiply it with the original.\n\nThis is best known as the \"Quake method\" (see also Where did Fast InvSqrt()\ncome from?). The more modern version used by contemporary CPU and GPUs are\ngeneralized into two instructions, one for estimating the initial guess (e.g.\nfrsqrte of ARMv8), another to run the following iterations (e.g. frsqrts of\nARMv8). Single-instruction version of sqrt is a micro-coded or pseudo-\ninstruction version of these two instructions.\n\nThe prerequisite for all of this is a multiplier.\n\nIf you want to calculate FP (i)sqrt, then you need a (fast) FP multiplier,\nwhich all FPUs have.\n\nIf you want to calculate integer (i)sqrt, then you need a (fast) integer\nmultiplier, which most CPUs don't have (historically). Otherwise it would be\ncalled a DSP.\n\nTo make it better, you need a (fast) multiplier that is twice the width of\nyour input to have sufficient precision, which most CPUs definitely don't have\nuntil \"relatively\" recently (relative to RetroComputing).\n\nAnd precision matters, or not?\n\nIf you look at the \"Quake method\" closely, you notice that one of the\niterations was commented out.\n\nThere are a lot of use cases where the extreme precision isn't necessary and\nit'll be better to leave the choice of precision/speed trade off to\nprogrammers. isqrt was intentionally separated into fsqrte and fsqrts on ARMv8\nexactly for this reason: so that the programmer can adjust the number of\nfsqrts for the desired speed and accuracy tradeoff.\n\nSo I don't quite agree to the statement that single instruction sqrt is very\ncommon. It's there because the IEEEE754 and the C stand math library requires\nit (for the flag bits and exceptions), but that doesn't mean it's frequently\nused.\n\nFurther reading\n\n  * SPRC542 TI's math library for C64x DSP (8-issue VLIW CPU with two 32x32=64 multipliers). In this library _iq _IQisqrt is implemented using Newton-Raphson iterations and _iq _IQsqrt is calculated by multiplying the original with the isqrt. The source code is available on request.\n  * SPRUGG9 TMS320C64x+ IQmath Library User's Guide.The user guide for SPRC542.\n  * My implementation of square root using binary search, that doesn't depend on a multiplier. Only basic ALU instructions are used. It is vigorously undocumented. I have no idea what I wrote but it seems to work.\n\n.\n\n    \n    \n    unsigned int usqrt(unsigned int x){ unsigned int a=0; unsigned int masksq=0,mask=0; unsigned int mask_shift=15; for(masksq=1u<<(mask_shift<<1),mask=1u<<(mask_shift); mask!=0; masksq=masksq>>2,mask=mask>>1,mask_shift--){ if(x>=masksq){ a=mask; break; } } x-=masksq;//masksq==a*a; mask=mask>>1; mask_shift--; while(mask>0){ unsigned int step=(mask<<mask_shift)+(a<<(mask_shift+1)); if(x>=step){ a|=mask; x-=step; } mask=mask>>1; mask_shift--; } return a; }\n\nShare\n\nCC BY-SA 4.0\n\nImprove this answer\n\nFollow this answer to receive notifications\n\nedited yesterday\n\nStephen Kitt\n\n122k1717 gold badges505505 silver badges462462 bronze badges\n\nanswered yesterday\n\nuser3528438user3528438\n\n1,3191111 silver badges1111 bronze badges\n\n10\n\n  * 2\n\nWhat is recent for RetroComputing? The 8086 (from 1978) definitely did have an\ninteger muliplier, even one that could multiply two 16 bit values into a 32\nbit value. These instructions weren't really fast, though, and thus assembly\nbooks back then suggested to use the shift-register approach, as this was\noften faster than using the native imul/idiv instructions.\n\n\u2013 PMF\n\nyesterday\n\n  * 1\n\n@PMF An integer multiply instruction doesn't say anything about a integer\nmultiplier.\n\n\u2013 user3528438\n\nyesterday\n\n  * 1\n\nIn what sense do IEEE-754 and the C standard math library require a single\ninstruction square root? As far as I know, all IEEE-754 cares about is things\nlike memory layout and precision, and all C cares about is semantics. Unless\nthere's something I'm missing, both will allow for the square root to be done\nin several instructions, a function call, or some memory-mapped funk like the\none the Nintendo DS has.\n\n\u2013 Omar and Lorraine\n\nyesterday\n\n  * 4\n\n@OmarandLorraine you're right that nothing in IEEE754 requires an instruction.\nYou're wrong about IEEE754 not defining semantics: the standard very much\ndefines operations like multiplications, conversion to integer and square\nroots, along with their correct result.\n\n\u2013 Marcus M\u00fcller\n\nyesterday\n\n  * @OmarandLorraine The IEEE 754 requirement for specific semantics of the operation (which are very much defined by the standard) heavily favors a single operation approach if not a single-instruction approach, because that helps ensure that programmers who need those semantics don\u2019t have to think about what they need to do to get those semantics.\n\n\u2013 Austin Hemmelgarn\n\nyesterday\n\n| Show 5 more comments\n\n## You must log in to answer this question.\n\n##\n\nNot the answer you're looking for? Browse other questions tagged\n\n  * history\n  * instruction-set\n\n.\n\n  * The Overflow Blog\n  * How do mixture-of-experts layers affect transformer models?\n\n  * What a year building AI has taught Stack Overflow\n\n  * Featured on Meta\n  * New Focus Styles & Updated Styling for Button Groups\n\n  * Upcoming initiatives on Stack Overflow and across the Stack Exchange network\n\n#### Linked\n\n16\n\nWhere did Fast InvSqrt() come from?\n\n#### Related\n\n14\n\nAre there any articles elucidating the history of the POPCOUNT instruction?\n\n12\n\nDid any 360-compatible machine implement registers in core?\n\n87\n\nWhy is the processor instruction called \"move\", not \"copy\"?\n\n17\n\nHas there ever been a instruction set architecture that did not require\ninstruction decoding at all?\n\n10\n\nDid any core-memory computers have a read-and-erase instruction?\n\n19\n\nHave there been any instruction sets with an odd register width?\n\n6\n\nWere there any square monitors other than PLATO?\n\n11\n\nIMPI Instruction set: is there any reference?\n\n11\n\nWhy did the VAX compatibility mode not implement the MARK instruction?\n\n#### Hot Network Questions\n\n  * What is the correct way to talk about the statute of limitations?\n\n  * Table within a table\n\n  * Book series begins near a city where only women are allowed to own homes\n\n  * My workmate wants me to teach her art but I would prefer to maintain a work-only boundary\n\n  * What international law did Ecuador break by storming the Mexican embassy?\n\n  * Can I safely refinish 250 gallon propane tank?\n\n  * Is infinity a concept or a word empty of meaning?\n\n  * Where do root systems arise in mathematics?\n\n  * Construct the point with two segments\n\n  * Redefine the command \\cite to be able to use an additional syntax\n\n  * Why do we need to prove extension lemmas?\n\n  * FTIR Spectra: Did I synthesize ethyl gallate from gallic acid?\n\n  * If a I rent a car in Zurich, Switzerland, can I return the car in Lauterbrunnen?\n\n  * Cirkuitikz: How to only rotate alternating current symbol?\n\n  * How to determine the signs of the op-amps in this circuit?\n\n  * Why do you need to set aside 10 cards when setting up the game?\n\n  * Normal force in a hypothetical rotating space station with simulated gravity\n\n  * How to identify small molecules in a structure without bonds\n\n  * Why do people keep saying 'it is your responsibility' to make sure your supervisor uploads their letter of rec (or similar)?\n\n  * How can I design a benevolent, all-powerful deity, and still have a society with day-to-day issues?\n\n  * Why did the US and Israel vote against making food a human right?\n\n  * Why do pilots have control of so many functions that seem like they should be always-on?\n\n  * How long is a second on the moon?\n\n  * Effects of a hypothetical \"proton-decay\" bomb for a fictional story\n\nQuestion feed\n\n# Subscribe to RSS\n\n  * Blog\n  * Facebook\n  * Twitter\n  * LinkedIn\n  * Instagram\n\nSite design / logo \u00a9 2024 Stack Exchange Inc; user contributions licensed\nunder CC BY-SA. rev 2024.4.5.7373\n\n## We Care About Your Privacy\n\nWe and our 4 partners store and/or access information on a device, such as\nunique IDs in cookies to process personal data. You may accept or manage your\nchoices by clicking below, including your right to object where legitimate\ninterest is used, or at any time in the privacy policy page. These choices\nwill be signaled to our partners and will not affect browsing data.\n\nCookie Policy.\n\n### We and our partners perform the following based on your settings:\n\nUse precise geolocation data. Actively scan device characteristics for\nidentification. Understand audiences through statistics or combinations of\ndata from different sources. Store and/or access information on a device.\nDevelop and improve services. Create profiles to personalise content. Measure\ncontent performance. Use limited data to select content. Measure advertising\nperformance. Use limited data to select advertising. Create profiles for\npersonalised advertising. Use profiles to select personalised advertising. Use\nprofiles to select personalised content.\n\n## About Your Privacy\n\nWe process your data to deliver content or advertisements and measure the\ndelivery of such content or advertisements to extract insights about our\nwebsite. We share this information with our partners on the basis of consent\nand legitimate interest. You may exercise your right to consent or object to a\nlegitimate interest, based on a specific purpose below or at a partner level\nin the link under each purpose. These choices will be signaled to our vendors\nparticipating in the Transparency and Consent Framework. Cookie Policy\n\n### Manage Consent Preferences\n\n#### Strictly Necessary Cookies\n\nAlways Active\n\nThese cookies are necessary for the website to function and cannot be switched\noff in our systems. They are usually only set in response to actions made by\nyou which amount to a request for services, such as setting your privacy\npreferences, logging in or filling in forms. You can set your browser to block\nor alert you about these cookies, but some parts of the site will not then\nwork. These cookies do not store any personally identifiable information.\n\n  * ##### Deliver and present advertising and content 3 partners can use this purpose\n\nlabel\n\nCertain information (like an IP address or device capabilities) is used to\nensure the technical compatibility of the content or advertising, and to\nfacilitate the transmission of the content or ad to your device.\n\n  * ##### Ensure security, prevent and detect fraud, and fix errors 3 partners can use this purpose\n\nlabel\n\nYour data can be used to monitor for and prevent unusual and possibly\nfraudulent activity (for example, regarding advertising, ad clicks by bots),\nand ensure systems and processes work properly and securely. It can also be\nused to correct any problems you, the publisher or the advertiser may\nencounter in the delivery of content and ads and in your interaction with\nthem.\n\n  * ##### Identify devices based on information transmitted automatically 3 partners can use this purpose\n\nlabel\n\nYour device might be distinguished from other devices based on information it\nautomatically sends when accessing the Internet (for instance, the IP address\nof your Internet connection or the type of browser you are using) in support\nof the purposes exposed in this notice.\n\n#### Functional Cookies\n\nThese cookies enable the website to provide enhanced functionality and\npersonalisation. They may be set by us or by third party providers whose\nservices we have added to our pages. If you do not allow these cookies then\nsome or all of these services may not function properly.\n\n  * ##### Use precise geolocation data 2 partners can use this purpose\n\nWith your acceptance, your precise location (within a radius of less than 500\nmetres) may be used in support of the purposes explained in this notice.\n\n  * ##### Link different devices 3 partners can use this purpose\n\nAlways Active\n\nIn support of the purposes explained in this notice, your device might be\nconsidered as likely linked to other devices that belong to you or your\nhousehold (for instance because you are logged in to the same service on both\nyour phone and your computer, or because you may use the same Internet\nconnection on both devices).\n\n#### Performance Cookies\n\nThese cookies allow us to count visits and traffic sources so we can measure\nand improve the performance of our site. They help us to know which pages are\nthe most and least popular and see how visitors move around the site. All\ninformation these cookies collect is aggregated and therefore anonymous. If\nyou do not allow these cookies we will not know when you have visited our\nsite, and will not be able to monitor its performance.\n\n  * ##### Store and/or access information on a device 4 partners can use this purpose\n\nCookies, device or similar online identifiers (e.g. login-based identifiers,\nrandomly assigned identifiers, network based identifiers) together with other\ninformation (e.g. browser type and information, language, screen size,\nsupported technologies etc.) can be stored or read on your device to recognise\nit each time it connects to an app or to a website, for one or several of the\npurposes presented here.\n\n  * ##### Develop and improve services 3 partners can use this purpose\n\nInformation about your activity on this service, such as your interaction with\nads or content, can be very helpful to improve products and services and to\nbuild new products and services based on user interactions, the type of\naudience, etc. This specific purpose does not include the development or\nimprovement of user profiles and identifiers.\n\n  * ##### Measure content performance 0 partners can use this purpose\n\nInformation regarding which content is presented to you and how you interact\nwith it can be used to determine whether the (non-advertising) content e.g.\nreached its intended audience and matched your interests. For instance,\nwhether you read an article, watch a video, listen to a podcast or look at a\nproduct description, how long you spent on this service and the web pages you\nvisit etc. This is very helpful to understand the relevance of (non-\nadvertising) content that is shown to you.\n\n  * ##### Measure advertising performance 4 partners can use this purpose\n\nInformation regarding which advertising is presented to you and how you\ninteract with it can be used to determine how well an advert has worked for\nyou or other users and whether the goals of the advertising were reached. For\ninstance, whether you saw an ad, whether you clicked on it, whether it led you\nto buy a product or visit a website, etc. This is very helpful to understand\nthe relevance of advertising campaigns.\n\n#### Targeting Cookies\n\nThese cookies are used to make advertising messages more relevant to you and\nmay be set through our site by us or by our advertising partners. They may be\nused to build a profile of your interests and show you relevant advertising on\nour site or on other sites. They do not store directly personal information,\nbut are based on uniquely identifying your browser and internet device.\n\n  * ##### Understand audiences through statistics or combinations of data from different sources 2 partners can use this purpose\n\nReports can be generated based on the combination of data sets (like user\nprofiles, statistics, market research, analytics data) regarding your\ninteractions and those of other users with advertising or (non-advertising)\ncontent to identify common characteristics (for instance, to determine which\ntarget audiences are more receptive to an ad campaign or to certain contents).\n\n  * ##### Create profiles to personalise content 1 partners can use this purpose\n\nInformation about your activity on this service (for instance, forms you\nsubmit, non-advertising content you look at) can be stored and combined with\nother information about you (such as your previous activity on this service or\nother websites or apps) or similar users. This is then used to build or\nimprove a profile about you (which might for example include possible\ninterests and personal aspects). Your profile can be used (also later) to\npresent content that appears more relevant based on your possible interests,\nsuch as by adapting the order in which content is shown to you, so that it is\neven easier for you to find content that matches your interests.\n\n  * ##### Use limited data to select advertising 4 partners can use this purpose\n\nAdvertising presented to you on this service can be based on limited data,\nsuch as the website or app you are using, your non-precise location, your\ndevice type or which content you are (or have been) interacting with (for\nexample, to limit the number of times an ad is presented to you).\n\n  * ##### Create profiles for personalised advertising 3 partners can use this purpose\n\nInformation about your activity on this service (such as forms you submit,\ncontent you look at) can be stored and combined with other information about\nyou (for example, information from your previous activity on this service and\nother websites or apps) or similar users. This is then used to build or\nimprove a profile about you (that might include possible interests and\npersonal aspects). Your profile can be used (also later) to present\nadvertising that appears more relevant based on your possible interests by\nthis and other entities.\n\n  * ##### Use profiles to select personalised advertising 4 partners can use this purpose\n\nAdvertising presented to you on this service can be based on your advertising\nprofiles, which can reflect your activity on this service or other websites or\napps (like the forms you submit, content you look at), possible interests and\npersonal aspects.\n\n  * ##### Use profiles to select personalised content 1 partners can use this purpose\n\nContent presented to you on this service can be based on your content\npersonalisation profiles, which can reflect your activity on this or other\nservices (for instance, the forms you submit, content you look at), possible\ninterests and personal aspects, such as by adapting the order in which content\nis shown to you, so that it is even easier for you to find (non-advertising)\ncontent that matches your interests.\n\n### Cookie List\n\nlabel\n\nConsent Leg.Interest\n\nlabel\n\nlabel\n\nlabel\n\n", "frontpage": true}
